# ğŸ—ï¸ AI Troubleshooter v7 - Architecture Diagrams

Comprehensive visual architecture documentation

---

## 1. System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                               â”‚
â”‚                     AI Troubleshooter v7 Architecture                        â”‚
â”‚                   Multi-Agent Self-Corrective RAG System                     â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                    USER
                                     â”‚
                                     â”‚ HTTPS (TLS Edge)
                                     â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    OpenShift Route                  â”‚
                    â”‚    ai-troubleshooter-v7            â”‚
                    â”‚    (TLS Termination)               â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    Service (ClusterIP)             â”‚
                    â”‚    Port: 8501                       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚  Pod: ai-troubleshooter-v7-xxxxxxxxx-xxxxx                                 â”‚
â”‚  ServiceAccount: ai-troubleshooter-v7-sa (ClusterRole: reader)             â”‚
â”‚  Image: registry.access.redhat.com/ubi9/python-311:latest                  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     Streamlit Frontend (Port 8501)                   â”‚  â”‚
â”‚  â”‚  â€¢ User Interface                                                     â”‚  â”‚
â”‚  â”‚  â€¢ 6 Result Tabs                                                      â”‚  â”‚
â”‚  â”‚  â€¢ Progress Tracking                                                  â”‚  â”‚
â”‚  â”‚  â€¢ Configuration Controls                                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                 â”‚                                            â”‚
â”‚                                 â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚            Kubernetes Data Collector (oc commands)                   â”‚  â”‚
â”‚  â”‚  â€¢ get namespaces                                                     â”‚  â”‚
â”‚  â”‚  â€¢ get pods -n {namespace}                                           â”‚  â”‚
â”‚  â”‚  â€¢ logs {pod} -n {namespace}                                         â”‚  â”‚
â”‚  â”‚  â€¢ get events -n {namespace}                                         â”‚  â”‚
â”‚  â”‚  â€¢ describe pod {pod} -n {namespace}                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                 â”‚                                            â”‚
â”‚                                 â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    LangGraph Multi-Agent Workflow                    â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚  â”‚
â”‚  â”‚    â”‚ RETRIEVE â”‚â”€â”€â”€â”€â”€â–¶â”‚  RERANK  â”‚â”€â”€â”€â”€â”€â–¶â”‚  GRADE   â”‚               â”‚  â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚  â”‚
â”‚  â”‚         â–²                                     â”‚                      â”‚  â”‚
â”‚  â”‚         â”‚                                     â–¼                      â”‚  â”‚
â”‚  â”‚         â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚  â”‚
â”‚  â”‚         â”‚                              â”‚ GENERATE â”‚                 â”‚  â”‚
â”‚  â”‚         â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚  â”‚
â”‚  â”‚         â”‚                                     â”‚                      â”‚  â”‚
â”‚  â”‚         â”‚                                     â–¼                      â”‚  â”‚
â”‚  â”‚         â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚  â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚TRANSFORM â”‚                 â”‚  â”‚
â”‚  â”‚                                        â”‚  QUERY   â”‚                 â”‚  â”‚
â”‚  â”‚                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚    Self-Correction Loop (Max 3 Iterations)                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                 â”‚                                            â”‚
â”‚                                 â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Hybrid Retriever Engine                           â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  â”‚
â”‚  â”‚    â”‚   BM25 (Lexical)    â”‚         â”‚  Milvus (Semantic)   â”‚        â”‚  â”‚
â”‚  â”‚    â”‚                     â”‚         â”‚                      â”‚        â”‚  â”‚
â”‚  â”‚    â”‚ â€¢ Keyword matching  â”‚         â”‚ â€¢ Vector similarity  â”‚        â”‚  â”‚
â”‚  â”‚    â”‚ â€¢ Error codes       â”‚    +    â”‚ â€¢ Embeddings search  â”‚        â”‚  â”‚
â”‚  â”‚    â”‚ â€¢ Exact strings     â”‚         â”‚ â€¢ Conceptual match   â”‚        â”‚  â”‚
â”‚  â”‚    â”‚ â€¢ In-memory index   â”‚         â”‚ â€¢ Optional (via API) â”‚        â”‚  â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚
â”‚  â”‚              â”‚                               â”‚                       â”‚  â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚  â”‚
â”‚  â”‚                          â–¼                                           â”‚  â”‚
â”‚  â”‚              Reciprocal Rank Fusion (RRF)                           â”‚  â”‚
â”‚  â”‚              score = Î£[1 / (k + rank)]                              â”‚  â”‚
â”‚  â”‚                          â”‚                                           â”‚  â”‚
â”‚  â”‚                          â–¼                                           â”‚  â”‚
â”‚  â”‚                  Top 10 Relevant Logs                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                 â”‚                                            â”‚
â”‚                                 â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Llama Stack Client                                â”‚  â”‚
â”‚  â”‚  â€¢ Chat Completion API                                                â”‚  â”‚
â”‚  â”‚  â€¢ RAG Tool (Vector DB Query)                                        â”‚  â”‚
â”‚  â”‚  â€¢ Model: llama-32-3b-instruct                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                 â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ HTTP (Internal)
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚  Namespace: model                                                           â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    Service: llamastack-custom-distribution-service                   â”‚  â”‚
â”‚  â”‚    Port: 8321                                                         â”‚  â”‚
â”‚  â”‚    Pod: llamastack-custom-distribution-xxx                           â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚    APIs:                                                              â”‚  â”‚
â”‚  â”‚    â€¢ /v1/inference/chat-completion                                   â”‚  â”‚
â”‚  â”‚    â€¢ /v1/tool-runtime/rag-tool/query                                 â”‚  â”‚
â”‚  â”‚    â€¢ /v1/models                                                       â”‚  â”‚
â”‚  â”‚    â€¢ /v1/health                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                 â”‚                                            â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                  â”‚              â”‚              â”‚                            â”‚
â”‚                  â–¼              â–¼              â–¼                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  LLM Model      â”‚  â”‚  Embedding      â”‚  â”‚  Vector DB      â”‚           â”‚
â”‚  â”‚  Llama 3.2 3B   â”‚  â”‚  Granite 125M   â”‚  â”‚  Milvus         â”‚           â”‚
â”‚  â”‚  KServe/VLLM    â”‚  â”‚  768 dimensions â”‚  â”‚  (Optional)     â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    Service: ocp-mcp-server (Model Context Protocol)                 â”‚  â”‚
â”‚  â”‚    Port: 8000                                                         â”‚  â”‚
â”‚  â”‚    Provides: Cluster introspection tools (optional)                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Multi-Agent Workflow (LangGraph)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         LangGraph State Machine                              â”‚
â”‚                       (Multi-Agent Orchestration)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                   START
                                     â”‚
                                     â–¼
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘   GraphState (Shared State)    â•‘
                    â•‘                                â•‘
                    â•‘ â€¢ question: str                â•‘
                    â•‘ â€¢ log_context: str             â•‘
                    â•‘ â€¢ pod_events: str              â•‘
                    â•‘ â€¢ retrieved_docs: List         â•‘
                    â•‘ â€¢ reranked_docs: List          â•‘
                    â•‘ â€¢ relevance_scores: List       â•‘
                    â•‘ â€¢ generation: str              â•‘
                    â•‘ â€¢ iteration: int               â•‘
                    â•‘ â€¢ transformation_history: List â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                     â”‚
                                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  NODE 1: RETRIEVE                                      â”‚
        â”‚  Agent: Hybrid Retriever                               â”‚
        â”‚                                                         â”‚
        â”‚  Input:  question, log_context, pod_events             â”‚
        â”‚  Process:                                               â”‚
        â”‚    1. Split logs into lines (documents)                â”‚
        â”‚    2. Build BM25 index (tokenize, index)              â”‚
        â”‚    3. BM25 search (keyword matching)                   â”‚
        â”‚    4. Milvus search (semantic, optional)              â”‚
        â”‚    5. RRF fusion (combine rankings)                    â”‚
        â”‚  Output: retrieved_docs (Top 10)                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  NODE 2: RERANK                                        â”‚
        â”‚  Agent: Score-Based Reranker                           â”‚
        â”‚                                                         â”‚
        â”‚  Input:  retrieved_docs                                â”‚
        â”‚  Process:                                               â”‚
        â”‚    1. Sort by relevance score (descending)            â”‚
        â”‚    2. Take top 5 documents                             â”‚
        â”‚  Output: reranked_docs (Top 5)                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  NODE 3: GRADE DOCUMENTS                               â”‚
        â”‚  Agent: LLM-Based Document Grader                      â”‚
        â”‚                                                         â”‚
        â”‚  Input:  reranked_docs, question                       â”‚
        â”‚  Process:                                               â”‚
        â”‚    For each document:                                  â”‚
        â”‚      1. Create grading prompt                          â”‚
        â”‚      2. LLM scores relevance (0.0-1.0)                â”‚
        â”‚      3. Keep if score â‰¥ 0.6                           â”‚
        â”‚  Output: relevance_scores, filtered reranked_docs      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  DECISION: Should we generate or transform query?      â”‚
        â”‚  Function: decide_to_generate()                        â”‚
        â”‚                                                         â”‚
        â”‚  Logic:                                                 â”‚
        â”‚    IF len(reranked_docs) > 0:                         â”‚
        â”‚        â†’ GENERATE                                      â”‚
        â”‚    ELIF iteration < max_iterations:                    â”‚
        â”‚        â†’ TRANSFORM QUERY (retry)                      â”‚
        â”‚    ELSE:                                               â”‚
        â”‚        â†’ GENERATE (give up, do best effort)           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                                  â”‚
                   â”‚ (has docs)                       â”‚ (no docs)
                   â–¼                                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  NODE 4: GENERATE    â”‚           â”‚  NODE 5: TRANSFORM QUERY     â”‚
    â”‚  Agent: LLM Analyzer â”‚           â”‚  Agent: Query Rewriter       â”‚
    â”‚                      â”‚           â”‚                              â”‚
    â”‚  Input: question,    â”‚           â”‚  Input: question, feedback,  â”‚
    â”‚         reranked_docsâ”‚           â”‚         original_question    â”‚
    â”‚         pod_status   â”‚           â”‚  Process:                    â”‚
    â”‚  Process:            â”‚           â”‚    1. Analyze why failed     â”‚
    â”‚    1. Build context  â”‚           â”‚    2. LLM rewrites query     â”‚
    â”‚    2. Create prompt  â”‚           â”‚    3. Make more specific     â”‚
    â”‚    3. LLM generates  â”‚           â”‚    4. Add keywords           â”‚
    â”‚       troubleshootingâ”‚           â”‚  Output: new question,       â”‚
    â”‚       analysis       â”‚           â”‚          iteration++         â”‚
    â”‚  Output: generation  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
                   â”‚                                  â”‚
                   â”‚                                  â”‚ (loop back)
                   â”‚                                  â”‚
                   â–¼                                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  DECISION: Is the answer good enough?                    â”‚
    â”‚  Function: grade_generation_vs_documents_and_question()  â”‚
    â”‚                                                           â”‚
    â”‚  Logic:                                                   â”‚
    â”‚    IF len(generation) > 100 AND has_docs:                â”‚
    â”‚        â†’ USEFUL (success, end)                           â”‚
    â”‚    ELIF len(generation) < 50 AND iteration < max:        â”‚
    â”‚        â†’ NOT USEFUL (retry)                              â”‚
    â”‚    ELIF "no relevant" in generation AND iteration < max: â”‚
    â”‚        â†’ NOT USEFUL (retry)                              â”‚
    â”‚    ELSE:                                                  â”‚
    â”‚        â†’ USEFUL (accept)                                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                                  â”‚
                   â”‚ (useful)                         â”‚ (not useful)
                   â–¼                                  â”‚
                  END â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  FINAL STATE                             â”‚
        â”‚  â€¢ generation (answer)                   â”‚
        â”‚  â€¢ reranked_docs (evidence)              â”‚
        â”‚  â€¢ iteration (# of retries)              â”‚
        â”‚  â€¢ transformation_history (query changes)â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            Data Flow (End-to-End)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

USER ACTION: Click "ğŸš€ Start Multi-Agent Analysis"
    â”‚
    â–¼
[Streamlit: Collect Input]
    â”œâ”€ selected_namespace: "test-problematic-pods"
    â”œâ”€ selected_pod: "crash-loop-app-xxx"
    â”œâ”€ include_logs: True
    â”œâ”€ include_events: True
    â””â”€ max_iterations: 3
    â”‚
    â–¼
[KubernetesDataCollector: Collect Data]
    â”œâ”€ oc get pod {pod} -n {ns} -o json â†’ pod_info
    â”œâ”€ oc logs {pod} -n {ns} --tail=100 â†’ logs (12,345 chars)
    â””â”€ oc get events -n {ns} â†’ events (28 events)
    â”‚
    â–¼
[Build Question]
    â”œâ”€ IF pod_status != "Running":
    â”‚     question = "Why is pod in {status} state?"
    â””â”€ ELSE:
          question = "Analyze pod for any issues or errors"
    â”‚
    â–¼
[Initialize GraphState]
    â”œâ”€ question: "Analyze pod crash-loop-app for errors"
    â”œâ”€ namespace: "test-problematic-pods"
    â”œâ”€ pod_name: "crash-loop-app-xxx"
    â”œâ”€ log_context: "2025-10-12 14:23:45 FATAL: out of memory\n..."
    â”œâ”€ pod_events: "Back-off restarting failed container\n..."
    â”œâ”€ pod_status: {phase: "Running", restartCount: 8, ...}
    â”œâ”€ retrieved_docs: []
    â”œâ”€ reranked_docs: []
    â”œâ”€ generation: ""
    â”œâ”€ iteration: 0
    â””â”€ max_iterations: 3
    â”‚
    â–¼
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            LANGGRAPH EXECUTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    â”‚
    â–¼
[NODE: RETRIEVE]
    â”‚
    â”œâ”€ Split log_context into lines
    â”‚     Input: "2025-10-12 14:23:45 FATAL: out of memory\n..."
    â”‚     Output: ["2025-10-12 14:23:45 FATAL: out of memory", ...]
    â”‚     Count: 103 log lines
    â”‚
    â”œâ”€ Build BM25 Index
    â”‚     â”œâ”€ Tokenize each line: ["2025", "10", "12", "fatal", "out", "of", "memory"]
    â”‚     â”œâ”€ Build BM25Okapi index (103 documents)
    â”‚     â””â”€ Index size: ~500KB in memory
    â”‚
    â”œâ”€ BM25 Search
    â”‚     Query: "analyze pod crash-loop-app for errors"
    â”‚     Tokens: ["analyze", "pod", "crash", "loop", "app", "errors"]
    â”‚     â”œâ”€ Compute BM25 scores for each document
    â”‚     â””â”€ Top 10: [doc_45 (score=12.3), doc_67 (score=11.8), ...]
    â”‚
    â”œâ”€ Milvus Search (Optional)
    â”‚     Query: "analyze pod crash-loop-app for errors"
    â”‚     â”œâ”€ Embed query â†’ [0.123, -0.456, ...] (768 dimensions)
    â”‚     â”œâ”€ Milvus similarity search
    â”‚     â””â”€ Result: Error (Vector DB not available) â†’ Fallback to BM25 only
    â”‚
    â”œâ”€ RRF Fusion
    â”‚     BM25 results: 8 documents
    â”‚     Vector results: 0 documents
    â”‚     â”œâ”€ Compute RRF scores: score = Î£[1 / (60 + rank)]
    â”‚     â””â”€ Combined top 10: [doc_45, doc_67, doc_23, ...]
    â”‚
    â””â”€ Output: retrieved_docs = [
          {content: "2025-10-12 14:23:45 FATAL: out of memory", score: 12.3, method: "bm25"},
          {content: "2025-10-12 14:23:47 Container exited with code 137", score: 11.8, method: "bm25"},
          ...
       ] (10 documents)
    â”‚
    â–¼
[NODE: RERANK]
    â”‚
    â”œâ”€ Input: 10 documents
    â”œâ”€ Sort by score (descending)
    â””â”€ Output: reranked_docs = Top 5 documents
    â”‚
    â–¼
[NODE: GRADE]
    â”‚
    â”œâ”€ For each of 5 documents:
    â”‚     â”œâ”€ Build prompt: "Grade relevance: Question: ... Log: ..."
    â”‚     â”œâ”€ LLM call â†’ response: "0.92"
    â”‚     â”œâ”€ Parse score: 0.92
    â”‚     â””â”€ Keep if â‰¥ 0.6
    â”‚
    â”œâ”€ Results:
    â”‚     â”œâ”€ Doc 1: 0.92 âœ…
    â”‚     â”œâ”€ Doc 2: 0.88 âœ…
    â”‚     â”œâ”€ Doc 3: 0.73 âœ…
    â”‚     â”œâ”€ Doc 4: 0.65 âœ…
    â”‚     â””â”€ Doc 5: 0.42 âŒ
    â”‚
    â””â”€ Output: reranked_docs = 4 documents, relevance_scores = [0.92, 0.88, 0.73, 0.65]
    â”‚
    â–¼
[DECISION: GENERATE]
    â”œâ”€ Check: len(reranked_docs) = 4 > 0? YES
    â””â”€ Route: GENERATE
    â”‚
    â–¼
[NODE: GENERATE]
    â”‚
    â”œâ”€ Build context from top 4 logs:
    â”‚     "Log 1: 2025-10-12 14:23:45 FATAL: out of memory
    â”‚      Log 2: 2025-10-12 14:23:47 Container exited with code 137
    â”‚      Log 3: Back-off restarting failed container
    â”‚      Log 4: OOMKilled"
    â”‚
    â”œâ”€ Build prompt:
    â”‚     "You are a senior OpenShift SRE...
    â”‚      Question: Analyze pod crash-loop-app for errors
    â”‚      Relevant Logs: [context]
    â”‚      Pod Context: {phase: Running, restartCount: 8, ...}
    â”‚      Provide: ISSUE, REFERENCES, ACTIONS, FIX"
    â”‚
    â”œâ”€ LLM call (Llama 3.2 3B)
    â”‚     â”œâ”€ Model: llama-32-3b-instruct
    â”‚     â”œâ”€ Max tokens: 500
    â”‚     â””â”€ Temperature: 0 (greedy)
    â”‚
    â””â”€ Output: generation = "
          ğŸš¨ ISSUE: Pod experiencing OOMKilled (Out of Memory)
          
          ğŸ“š REFERENCES:
            â€¢ Log Line 45: 'FATAL: out of memory'
            â€¢ Log Line 67: 'Exit code: 137 (OOMKilled)'
            â€¢ Event: 'Back-off restarting failed container'
          
          âš¡ ACTIONS:
            1. oc describe pod crash-loop-app-xxx -n test-problematic-pods
            2. oc logs crash-loop-app-xxx -n test-problematic-pods --previous
            3. oc set resources deployment crash-loop-app --limits=memory=2Gi
          
          ğŸ”§ FIX:
            Container exceeding 512Mi memory limit. Increase to 1Gi or optimize app.
       " (243 words)
    â”‚
    â–¼
[DECISION: IS ANSWER GOOD?]
    â”œâ”€ Check: len(generation) = 243 > 100? YES
    â”œâ”€ Check: has docs = 4 > 0? YES
    â”œâ”€ Check: "no relevant" in generation? NO
    â””â”€ Route: USEFUL (END)
    â”‚
    â–¼
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                         WORKFLOW COMPLETE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    â”‚
    â–¼
[FINAL STATE]
    â”œâ”€ generation: "ğŸš¨ ISSUE: Pod experiencing OOMKilled..."
    â”œâ”€ reranked_docs: [4 relevant logs]
    â”œâ”€ relevance_scores: [0.92, 0.88, 0.73, 0.65]
    â”œâ”€ iteration: 1 (only needed 1 iteration!)
    â””â”€ transformation_history: [] (no transformations needed)
    â”‚
    â–¼
[Return to Streamlit]
    â”œâ”€ success: True
    â”œâ”€ answer: "ğŸš¨ ISSUE: ..."
    â”œâ”€ relevant_docs: [4 logs]
    â”œâ”€ iterations: 1
    â””â”€ metadata: {retrieval_time: 1.2s, llm_time: 2.1s, ...}
    â”‚
    â–¼
[Display in UI]
    â”œâ”€ Tab 1: Multi-Agent Analysis â†’ Show "ğŸš¨ ISSUE: ..."
    â”œâ”€ Tab 2: Evidence â†’ Show 4 relevant logs with scores
    â”œâ”€ Tab 3: Workflow â†’ Show node execution trace
    â”œâ”€ Tab 4: Pod Details â†’ Show oc describe output
    â”œâ”€ Tab 5: Metrics â†’ Show 10 retrieved, 4 relevant, 1 iteration
    â””â”€ Tab 6: Storage â†’ Show PVC status
    â”‚
    â–¼
USER SEES RESULT (Total time: ~5 seconds)
```

---

## 4. RBAC & Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        RBAC & Security Architecture                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   ServiceAccount    â”‚
                          â”‚ ai-troubleshooter-  â”‚
                          â”‚      v7-sa          â”‚
                          â”‚                     â”‚
                          â”‚ Namespace:          â”‚
                          â”‚ ai-troubleshooter-v7â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ bound to
                                    â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚  ClusterRoleBinding â”‚
                          â”‚ ai-troubleshooter-  â”‚
                          â”‚   v7-binding        â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ references
                                    â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚    ClusterRole      â”‚
                          â”‚ ai-troubleshooter-  â”‚
                          â”‚    v7-reader        â”‚
                          â”‚                     â”‚
                          â”‚  PERMISSIONS        â”‚
                          â”‚  (Read-Only)        â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚               â”‚               â”‚
                    â–¼               â–¼               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Core API     â”‚ â”‚  Apps API     â”‚ â”‚  Route API    â”‚
        â”‚  Group: ""    â”‚ â”‚  Group: apps  â”‚ â”‚  Group:       â”‚
        â”‚               â”‚ â”‚               â”‚ â”‚  route.       â”‚
        â”‚  Resources:   â”‚ â”‚  Resources:   â”‚ â”‚  openshift.io â”‚
        â”‚  â€¢ namespaces â”‚ â”‚  â€¢ deploymentsâ”‚ â”‚               â”‚
        â”‚  â€¢ pods       â”‚ â”‚  â€¢ replicasetsâ”‚ â”‚  Resources:   â”‚
        â”‚  â€¢ pods/log   â”‚ â”‚  â€¢ statefulsetâ”‚ â”‚  â€¢ routes     â”‚
        â”‚  â€¢ events     â”‚ â”‚               â”‚ â”‚               â”‚
        â”‚  â€¢ pvcs       â”‚ â”‚  Verbs:       â”‚ â”‚  Verbs:       â”‚
        â”‚  â€¢ services   â”‚ â”‚  â€¢ get        â”‚ â”‚  â€¢ get        â”‚
        â”‚               â”‚ â”‚  â€¢ list       â”‚ â”‚  â€¢ list       â”‚
        â”‚  Verbs:       â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚  â€¢ get        â”‚
        â”‚  â€¢ list       â”‚
        â”‚  â€¢ watch      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

What CAN the ServiceAccount do?
âœ… List all namespaces across cluster
âœ… List all pods in any namespace
âœ… Read pod logs from any pod
âœ… List events in any namespace
âœ… Get pod details (oc describe)
âœ… List PVCs, deployments, services
âœ… List OpenShift routes

What CANNOT the ServiceAccount do?
âŒ Create/delete/update any resources
âŒ Execute commands inside pods (except via oc exec which is read-only)
âŒ Read secrets
âŒ Modify RBAC roles/bindings
âŒ Access node resources
âŒ Create/delete namespaces
âŒ Scale deployments
âŒ Restart pods (except by deleting them, which it can't do)

Network Security:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Inbound Traffic:                                            â”‚
â”‚  â”œâ”€ User Browser â†’ Route (HTTPS, TLS edge termination)      â”‚
â”‚  â””â”€ Only port 8501 exposed                                  â”‚
â”‚                                                               â”‚
â”‚  Outbound Traffic:                                           â”‚
â”‚  â”œâ”€ Pod â†’ Kubernetes API Server (authenticated via SA token)â”‚
â”‚  â”œâ”€ Pod â†’ Llama Stack (HTTP, internal ClusterIP)           â”‚
â”‚  â””â”€ No external internet access                             â”‚
â”‚                                                               â”‚
â”‚  ServiceAccount Token:                                       â”‚
â”‚  â”œâ”€ Auto-mounted at /var/run/secrets/kubernetes.io/...     â”‚
â”‚  â”œâ”€ Used by oc client for authentication                    â”‚
â”‚  â””â”€ Scoped to ClusterRole permissions                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Deployment Architecture                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Namespace: ai-troubleshooter-v7
â”‚
â”œâ”€ ConfigMap: ai-troubleshooter-v7-code
â”‚  â”œâ”€ app.py (v7_streamlit_app.py)
â”‚  â”œâ”€ state_schema.py (v7_state_schema.py)
â”‚  â”œâ”€ hybrid_retriever.py (v7_hybrid_retriever.py)
â”‚  â”œâ”€ graph_nodes.py (v7_graph_nodes.py)
â”‚  â”œâ”€ graph_edges.py (v7_graph_edges.py)
â”‚  â”œâ”€ main_graph.py (v7_main_graph.py)
â”‚  â””â”€ log_collector.py (v7_log_collector.py)
â”‚
â”œâ”€ ServiceAccount: ai-troubleshooter-v7-sa
â”‚  â””â”€ Bound to ClusterRole via ClusterRoleBinding
â”‚
â”œâ”€ Deployment: ai-troubleshooter-v7
â”‚  â”‚
â”‚  â”œâ”€ Replicas: 1
â”‚  â”œâ”€ Strategy: RollingUpdate
â”‚  â”œâ”€ Selector: app=ai-troubleshooter-v7
â”‚  â”‚
â”‚  â””â”€ Pod Template:
â”‚     â”‚
â”‚     â”œâ”€ Labels:
â”‚     â”‚  â”œâ”€ app: ai-troubleshooter-v7
â”‚     â”‚  â”œâ”€ version: v7
â”‚     â”‚  â””â”€ component: multi-agent-rag
â”‚     â”‚
â”‚     â”œâ”€ ServiceAccount: ai-troubleshooter-v7-sa
â”‚     â”‚
â”‚     â””â”€ Container: streamlit-app
â”‚        â”‚
â”‚        â”œâ”€ Image: registry.access.redhat.com/ubi9/python-311:latest
â”‚        â”‚
â”‚        â”œâ”€ Command: /bin/bash
â”‚        â”‚
â”‚        â”œâ”€ Args:
â”‚        â”‚  â””â”€ -c |
â”‚        â”‚     1. Install oc client â†’ ~/bin/oc
â”‚        â”‚     2. pip install dependencies (fire, langgraph, llama-stack-client, ...)
â”‚        â”‚     3. Copy code from /app-config/*.py â†’ /tmp/
â”‚        â”‚     4. streamlit run /tmp/app.py --port 8501
â”‚        â”‚
â”‚        â”œâ”€ Environment Variables:
â”‚        â”‚  â”œâ”€ LLAMA_STACK_URL: http://llamastack-custom-distribution-service.model...
â”‚        â”‚  â”œâ”€ LLAMA_STACK_MODEL: llama-32-3b-instruct
â”‚        â”‚  â”œâ”€ EMBEDDING_MODEL: granite-embedding-125m
â”‚        â”‚  â”œâ”€ EMBEDDING_DIMENSION: 768
â”‚        â”‚  â”œâ”€ VECTOR_DB_ID: openshift-logs-v7
â”‚        â”‚  â””â”€ MAX_ITERATIONS: 3
â”‚        â”‚
â”‚        â”œâ”€ Ports:
â”‚        â”‚  â””â”€ containerPort: 8501 (TCP)
â”‚        â”‚
â”‚        â”œâ”€ Resources:
â”‚        â”‚  â”œâ”€ Requests: CPU 250m, Memory 512Mi
â”‚        â”‚  â””â”€ Limits: CPU 1, Memory 2Gi
â”‚        â”‚
â”‚        â”œâ”€ Liveness Probe:
â”‚        â”‚  â”œâ”€ httpGet: path=/, port=8501
â”‚        â”‚  â”œâ”€ initialDelaySeconds: 120
â”‚        â”‚  â””â”€ periodSeconds: 30
â”‚        â”‚
â”‚        â”œâ”€ Readiness Probe:
â”‚        â”‚  â”œâ”€ httpGet: path=/, port=8501
â”‚        â”‚  â”œâ”€ initialDelaySeconds: 60
â”‚        â”‚  â””â”€ periodSeconds: 10
â”‚        â”‚
â”‚        â””â”€ Volume Mounts:
â”‚           â””â”€ /app-config â†’ ConfigMap (ai-troubleshooter-v7-code)
â”‚
â”œâ”€ Service: ai-troubleshooter-v7-service
â”‚  â”œâ”€ Type: ClusterIP
â”‚  â”œâ”€ Selector: app=ai-troubleshooter-v7
â”‚  â””â”€ Ports:
â”‚     â””â”€ name: http, port: 8501, targetPort: 8501
â”‚
â””â”€ Route: ai-troubleshooter-v7
   â”œâ”€ Host: ai-troubleshooter-v7-ai-troubleshooter-v7.apps.rosa.loki123...
   â”œâ”€ To: Service/ai-troubleshooter-v7-service
   â”œâ”€ Port: targetPort: http (8501)
   â”œâ”€ TLS:
   â”‚  â”œâ”€ termination: edge
   â”‚  â””â”€ insecureEdgeTerminationPolicy: Redirect
   â””â”€ Wildcard Policy: None

Startup Sequence:
1. [0s]   Pod scheduled, pull image (registry.access.redhat.com/ubi9/python-311)
2. [10s]  Image pulled, container starts, bash script begins
3. [15s]  Download oc client (~70MB)
4. [25s]  Install pip dependencies (~120s)
5. [145s] Copy code from ConfigMap to /tmp/
6. [150s] Start Streamlit on port 8501
7. [155s] Readiness probe succeeds (HTTP 200 on /)
8. [160s] Service routes traffic to pod
9. [165s] Route becomes accessible (HTTPS)

Total startup time: ~2.5-3 minutes
```

---

---

## 6. Future Enterprise Architecture (ServiceNow Integration)

**Note**: This is the **FUTURE** enterprise extension. Current v7 uses BM25-only (no vector DB required).

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           FUTURE: Enterprise RAG with ServiceNow Integration                â”‚
â”‚                      (2-Source Hybrid Knowledge System)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

KNOWLEDGE SOURCES (2):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                               â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚      ServiceNow KB       â”‚              â”‚      Live Pods           â”‚  â”‚
â”‚     â”‚   (Customer Knowledge)   â”‚              â”‚   (OpenShift Cluster)    â”‚  â”‚
â”‚     â”‚                          â”‚              â”‚                          â”‚  â”‚
â”‚     â”‚  â€¢ Past Incidents        â”‚              â”‚  â€¢ Pod Logs (100 lines)  â”‚  â”‚
â”‚     â”‚  â€¢ INC001234             â”‚              â”‚  â€¢ Kubernetes Events     â”‚  â”‚
â”‚     â”‚  â€¢ Tested Resolutions    â”‚              â”‚  â€¢ Pod Status            â”‚  â”‚
â”‚     â”‚  â€¢ Root Cause Analysis   â”‚              â”‚  â€¢ Real-time Data        â”‚  â”‚
â”‚     â”‚  â€¢ Company-specific      â”‚              â”‚  â€¢ Ephemeral             â”‚  â”‚
â”‚     â”‚  â€¢ Proven fixes âœ…       â”‚              â”‚  â€¢ Current state âœ…      â”‚  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â”‚                                          â”‚                â”‚
â”‚                  â”‚ (Webhook on ticket close)                â”‚ (oc commands)  â”‚
â”‚                  â”‚                                          â”‚                â”‚
â”‚                  â–¼                                          â–¼                â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚   Milvus Vector DB       â”‚              â”‚     BM25 Index           â”‚  â”‚
â”‚     â”‚   (Persistent)           â”‚              â”‚     (In-Memory)          â”‚  â”‚
â”‚     â”‚                          â”‚              â”‚                          â”‚  â”‚
â”‚     â”‚  Collection: customer-kb â”‚              â”‚  Built per analysis      â”‚  â”‚
â”‚     â”‚  â€¢ Semantic search       â”‚              â”‚  â€¢ Keyword matching      â”‚  â”‚
â”‚     â”‚  â€¢ Embedding: Granite    â”‚              â”‚  â€¢ Lexical search        â”‚  â”‚
â”‚     â”‚  â€¢ 768 dimensions        â”‚              â”‚  â€¢ ~100-200 documents    â”‚  â”‚
â”‚     â”‚  â€¢ Auto-updated          â”‚              â”‚  â€¢ Tokenized logs        â”‚  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â”‚                                          â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                                          â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               AI TROUBLESHOOTER v7 (2-Source Hybrid RAG)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                 HYBRID RETRIEVAL (2 Sources)                          â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  User Query: "Pod crash-loop-app in CrashLoopBackOff"                â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚     â”‚   ServiceNow Search     â”‚        â”‚   Live Logs Search      â”‚   â”‚  â”‚
â”‚  â”‚     â”‚   (Milvus Vector)       â”‚        â”‚   (BM25 Keyword)        â”‚   â”‚  â”‚
â”‚  â”‚     â”‚                         â”‚        â”‚                         â”‚   â”‚  â”‚
â”‚  â”‚     â”‚  Query: Semantic        â”‚        â”‚  Query: Keywords        â”‚   â”‚  â”‚
â”‚  â”‚     â”‚  "Similar past issues"  â”‚        â”‚  "OOM, crash, error"    â”‚   â”‚  â”‚
â”‚  â”‚     â”‚                         â”‚        â”‚                         â”‚   â”‚  â”‚
â”‚  â”‚     â”‚  Embedding â†’ 768D       â”‚        â”‚  Tokenize â†’ BM25        â”‚   â”‚  â”‚
â”‚  â”‚     â”‚  Search Milvus          â”‚        â”‚  Search index           â”‚   â”‚  â”‚
â”‚  â”‚     â”‚                         â”‚        â”‚                         â”‚   â”‚  â”‚
â”‚  â”‚     â”‚  Results:               â”‚        â”‚  Results:               â”‚   â”‚  â”‚
â”‚  â”‚     â”‚  â€¢ INC001234 âœ…         â”‚        â”‚  â€¢ "FATAL: OOM"         â”‚   â”‚  â”‚
â”‚  â”‚     â”‚    (Score: 0.92)        â”‚        â”‚    (Score: 12.3)        â”‚   â”‚  â”‚
â”‚  â”‚     â”‚  â€¢ INC005678            â”‚        â”‚  â€¢ "Exit code 137"      â”‚   â”‚  â”‚
â”‚  â”‚     â”‚    (Score: 0.81)        â”‚        â”‚    (Score: 11.8)        â”‚   â”‚  â”‚
â”‚  â”‚     â”‚  â€¢ ... (Top 10)         â”‚        â”‚  â€¢ ... (Top 10)         â”‚   â”‚  â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                 â”‚                                  â”‚                  â”‚  â”‚
â”‚  â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚  â”‚
â”‚  â”‚                                â”‚                                      â”‚  â”‚
â”‚  â”‚                                â–¼                                      â”‚  â”‚
â”‚  â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚  â”‚
â”‚  â”‚                   â”‚   RRF FUSION            â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚   (2-way merge)         â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚                         â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚  Formula:               â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚  score = Î£[1/(k+rank)]  â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚                         â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚  Combines:              â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚  â€¢ ServiceNow rankings  â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚  â€¢ Live log rankings    â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚                         â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚  Boosts documents       â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚  that rank HIGH in      â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚  BOTH systems! ğŸ†       â”‚                        â”‚  â”‚
â”‚  â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚  â”‚
â”‚  â”‚                               â”‚                                      â”‚  â”‚
â”‚  â”‚                               â–¼                                      â”‚  â”‚
â”‚  â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚  â”‚
â”‚  â”‚                   â”‚   SMART DECISION        â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚                         â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚  IF ServiceNow match    â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚  with score > 0.8:      â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚  âœ… Use proven solution â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚     from INC001234      â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚                         â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚  ELSE:                  â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚  ğŸ¤– Generate new        â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚     solution using      â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚     LLM + live logs     â”‚                        â”‚  â”‚
â”‚  â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚  â”‚
â”‚  â”‚                               â”‚                                      â”‚  â”‚
â”‚  â”‚                               â–¼                                      â”‚  â”‚
â”‚  â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚  â”‚
â”‚  â”‚                   â”‚   FINAL ANSWER          â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚   (Tagged by source)    â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚                         â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚  Option A:              â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚  ğŸ« [ServiceNow]        â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚  "Known issue INC001234 â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚   Tested solution:      â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚   oc set resources...   â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚   Root cause: Memory    â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚   leak in v2.3"         â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚                         â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚  Option B:              â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚  ğŸ¤– [AI Generated]      â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚  "New issue detected    â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚   Analysis: ...         â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚   Recommendation: ..."  â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚                         â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚  + Confidence score     â”‚                        â”‚  â”‚
â”‚  â”‚                   â”‚  + Source references    â”‚                        â”‚  â”‚
â”‚  â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   FEEDBACK LOOP             â”‚
                    â”‚                             â”‚
                    â”‚  IF answer = [AI Generated]:â”‚
                    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
                    â”‚  â€¢ Save to ServiceNow       â”‚
                    â”‚  â€¢ Create ticket with       â”‚
                    â”‚    resolution               â”‚
                    â”‚  â€¢ Embed & index            â”‚
                    â”‚  â€¢ Available for next time  â”‚
                    â”‚                             â”‚
                    â”‚  System learns! ğŸ”„          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Key Benefits of ServiceNow Integration

**1. Customer-Specific Knowledge**
- Uses YOUR company's proven solutions
- No generic documentation
- Real resolutions that worked before

**2. Prioritizes Proven Solutions**
```
Decision Logic:
â”œâ”€ IF ServiceNow has high-confidence match (>0.8)
â”‚  â””â”€ Use tested solution âœ…
â”œâ”€ ELSE
â”‚  â””â”€ Generate new solution with LLM ğŸ¤–
â””â”€ Always tag answer with source
```

**3. Learning System**
```
Continuous Improvement:
Issue â†’ Analysis â†’ Resolution â†’ ServiceNow â†’ Future reuse
                                    â†‘                 â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      Feedback Loop
```

**4. Multi-Source Intelligence**
- **ServiceNow**: What worked before?
- **Live Logs**: What's happening now?
- **RRF Fusion**: Best of both worlds

**5. Real-Time + Historical**
- Historical: ServiceNow KB (persistent knowledge)
- Real-Time: Live pod logs (current state)
- Combined: Comprehensive analysis

---

### Example Flow with ServiceNow

**Scenario:** Pod OOMKilled in production

**Step 1: Query ServiceNow**
```
Search Milvus: "pod oomkilled crashloopbackoff"
Result: INC001234 (Confidence: 0.92)
  - Issue: "Pod OOMKilled due to memory leak"
  - Resolution: "Increase memory to 1Gi"
  - Root Cause: "Memory leak in v2.3"
  - Tested: âœ… 2025-09-15
```

**Step 2: Query Live Logs**
```
Search BM25: "oom killed error"
Result: 
  - "FATAL: out of memory" (Score: 12.3)
  - "Exit code 137 OOMKilled" (Score: 11.8)
  - Confirms same issue!
```

**Step 3: RRF Fusion**
```
Combined Evidence:
  âœ… ServiceNow: High confidence (0.92)
  âœ… Live Logs: Confirms same pattern (OOM)
  â†’ Decision: Use ServiceNow solution
```

**Step 4: Answer**
```
ğŸ« KNOWN ISSUE (ServiceNow INC001234)

Your team solved this on 2025-09-15

Root Cause: Memory leak in application v2.3

Tested Solution:
oc set resources deployment crash-loop-app \
  --limits=memory=1Gi --requests=memory=512Mi

Resolution confirmed working by:
  - SRE Team (John Doe)
  - Incident closed: 2025-09-15
  
Confidence: 92%
Source: ServiceNow INC001234
```

---

### Implementation Considerations

**1. ServiceNow Webhook Setup**
```
Trigger: Ticket status â†’ Closed with resolution
Action: POST to /api/ingest-resolution
Payload:
  - Incident ID
  - Title & Description
  - Resolution steps
  - Root cause analysis
  - Timestamps
```

**2. Vector DB Setup**
```
Register with Llama Stack:
  vector_db_id: "customer-kb"
  embedding_model: "granite-embedding-125m"
  dimension: 768
  provider: "milvus"

Ingest ServiceNow data:
  - Embed resolution text
  - Store metadata (INC ID, date, SRE)
  - Index for fast search
```

**3. Query Strategy**
```
Parallel queries (async):
  â”œâ”€ ServiceNow: Semantic search
  â””â”€ Live Logs: BM25 keyword search

Wait for both â†’ RRF fusion â†’ Decision
```

**4. Decision Threshold**
```
IF servicenow_score > 0.8 AND logs_confirm_issue:
    return servicenow_solution
ELIF servicenow_score > 0.6:
    return hybrid_answer (ServiceNow + Generated)
ELSE:
    return generated_solution
```

---

### Comparison: Current v7 vs Future Enterprise

| Feature | Current v7 | Future Enterprise |
|---------|------------|-------------------|
| **Knowledge Sources** | Live logs only | ServiceNow + Live logs |
| **Vector DB** | Optional (not used) | Required for ServiceNow |
| **Retrieval** | BM25 only | Hybrid (BM25 + Milvus) |
| **RRF Fusion** | N/A (single source) | 2-way fusion |
| **Knowledge Type** | Real-time only | Historical + Real-time |
| **Learning** | Per-session | Continuous (feedback loop) |
| **Custom KB** | No | Yes (company-specific) |
| **Proven Solutions** | No | Yes (from ServiceNow) |
| **Deployment** | âœ… Production ready | ğŸ”„ Optional add-on |

---

**Last Updated**: October 12, 2025  
**Version**: 7.0.0  
**Cluster**: loki123.orwi.p3.openshiftapps.com

`